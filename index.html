<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Desk | Media Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --color-bg-dark: #1A1A1A; --color-bg-card: #222222; --color-text-light: #F4F7F6;
            --color-accent-blue: #4A90E2; --color-accent-green: #50C479; --color-header-bg: #2C3E50;
            --color-shadow: rgba(0, 0, 0, 0.4); --color-code-bg: #282C34; --color-code-text: #ABB2BF;
            --color-code-keyword: #C678DD; --color-code-string: #98C379;
        }
        * {
            box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s, transform 0.3s, box-shadow 0.3s;
        }
        body { background-color: var(--color-bg-dark); color: var(--color-text-light); line-height: 1.6; overflow-x: hidden; }

        .header { background-color: var(--color-header-bg); padding: 20px 5%; box-shadow: 0 4px 15px var(--color-shadow); position: sticky; top: 0; z-index: 1000; }
        .header h1 { font-size: 2.5em; color: var(--color-text-light); display: inline-block; opacity: 0; animation: fadeIn 1s forwards 0.2s; }
        .navbar a { color: var(--color-text-light); text-decoration: none; margin-left: 25px; font-size: 1.1em; padding: 5px 10px; border-bottom: 2px solid transparent; }
        .navbar a:hover { color: var(--color-accent-blue); border-bottom: 2px solid var(--color-accent-blue); }

        .container { width: 90%; max-width: 1300px; margin: 0 auto; padding: 40px 0; }
        .section-title { font-size: 2.8em; color: var(--color-accent-blue); margin-bottom: 30px; border-bottom: 3px solid var(--color-accent-blue); padding-bottom: 10px; text-align: center; opacity: 0; transform: translateY(20px); }
        .card { background-color: var(--color-bg-card); padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 8px 16px var(--color-shadow); opacity: 0; transform: translateY(20px); }
        .card-header { font-size: 1.8em; color: var(--color-accent-green); margin-bottom: 15px; border-left: 5px solid var(--color-accent-green); padding-left: 15px; }

        .architecture-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .architecture-item { padding: 20px; border-radius: 8px; background: linear-gradient(45deg, #2c2c2c, #1f1f1f); border: 1px solid #333; }
        .architecture-item h3 { color: var(--color-accent-blue); margin-bottom: 10px; font-size: 1.4em; }

        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        .data-table th { background-color: #333; color: var(--color-accent-green); font-weight: bold; }
        .data-table tr:hover { background-color: #333; }

        .code-container { display: flex; flex-direction: column; gap: 20px; }
        .code-block-wrapper { background-color: var(--color-bg-card); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px var(--color-shadow); }
        .code-header { background-color: var(--color-accent-blue); color: var(--color-text-light); padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: bold; font-size: 1.1em; }
        .code-header i { margin-right: 10px; }
        .download-btn { background-color: var(--color-accent-green); color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-size: 0.9em; margin-left: 15px; display: inline-block; }
        .download-btn:hover { background-color: #3aa564; transform: scale(1.05); }
        .code-content { background-color: var(--color-code-bg); max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        .code-content.open { max-height: 80vh; overflow-y: auto; }
        .code-pre { padding: 20px; color: var(--color-code-text); font-family: 'Consolas', 'Monaco', 'Courier New', monospace; white-space: pre-wrap; word-wrap: break-word; font-size: 0.9em; }
        .code-pre .keyword { color: var(--color-code-keyword); font-weight: bold; }
        .code-pre .string { color: var(--color-code-string); }
        .code-pre .comment { color: #5C6370; }
        .code-pre .function { color: #61AFEF; }
        .code-pre .class { color: #E5C07B; }

        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        .animated { opacity: 0; transform: translateY(20px); }
    </style>
</head>
<body>

    <header class="header">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="color: var(--color-accent-green);"><i class="fas fa-book-open"></i> Library Desk</h1>
            <nav class="navbar">
                <a href="#features">Features</a>
                <a href="#architecture">Architecture</a>
                <a href="#ui">UI / UX</a>
                <a href="#code">Code</a>
                </nav>
        </div>
    </header>

    <main class="container">

        <section id="overview">
            <h2 class="section-title animated" data-delay="0.4"><i class="fas fa-desktop"></i> Application Overview</h2>
            <div class="card animated" data-delay="0.5">
                <p>The **Library Desk** application is a modern, responsive media management system built using Python's **Flask** (Backend) and **Tkinter** (Frontend) to catalog and organize various media types (Books, Films, Magazines). It features robust CRUD capabilities, a dedicated favorites system, and real-time statistics, promoting a fast and intuitive desktop experience.</p>
            </div>
        </section>

        <section id="features">
            <h2 class="section-title animated" data-delay="0.6"><i class="fas fa-list-check"></i> Key Features</h2>
            <div class="card animated" data-delay="0.7">
                <div class="architecture-grid">
                    <div class="architecture-item">
                        <h3><i class="fas fa-pencil-alt"></i> Comprehensive Cataloging</h3>
                        <p>Store metadata including Name, Author, Category, and Publication Date. All data is managed through a lightweight JSON data store.</p>
                    </div>
                    <div class="architecture-item">
                        <h3><i class="fas fa-database"></i> Persistent Data Storage</h3>
                        <p>Utilizes a `media_data.json` file for local, persistent storage, ensuring all data is saved across application sessions.</p>
                    </div>
                    <div class="architecture-item">
                        <h3><i class="fas fa-search"></i> Advanced Filtering & Search</h3>
                        <p>Easily filter the media list by category (Book, Film, Magazine) or perform real-time, name-based searches.</p>
                    </div>
                    <div class="architecture-item">
                        <h3><i class="fas fa-star"></i> Favorites Management</h3>
                        <p>Quickly mark, manage, and view media items as favorites for quick access and tracking.</p>
                    </div>
                    <div class="architecture-item">
                        <h3><i class="fas fa-chart-bar"></i> Real-time Statistics</h3>
                        <p>A dedicated panel provides live counts for total items, total favorites, and a category breakdown, fetched via a dedicated `/stats` API route.</p>
                    </div>
                    </div>
            </div>
        </section>

        <section id="architecture">
            <h2 class="section-title animated" data-delay="0.8"><i class="fas fa-cubes"></i> System Architecture</h2>
            <div class="card animated" data-delay="0.9">
                <h3 class="card-header"><i class="fas fa-sitemap"></i> Components & Technologies</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Technology</th>
                            <th>Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>**Frontend (Client)**</td>
                            <td>Python (Tkinter)</td>
                            <td>Handles User Interface, displays data, collects user input, and sends HTTP requests.</td>
                        </tr>
                        <tr>
                            <td>**Backend (Server)**</td>
                            <td>Python (Flask)</td>
                            <td>Processes business logic, manages HTTP routing, and serves as the API gateway to the database.</td>
                        </tr>
                        <tr>
                            <td>**Database/Data Store**</td>
                            <td>Python (JSON file)</td>
                            <td>Manages persistent storage, retrieval, and modification of media metadata.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="card animated" data-delay="1.0">
                <h3 class="card-header"><i class="fas fa-plug"></i> Backend-Frontend Communication</h3>
                <p>Communication is implemented using **RESTful HTTP requests**. The Tkinter Frontend acts as an HTTP client, communicating with the Flask Backend API. This allows for a clear separation of UI/Presentation logic and Data/Business logic.</p>
                <div class="architecture-item" style="margin-top: 15px;">
                    <h4><i class="fas fa-exchange-alt"></i> Communication Flow Example (Adding Media)</h4>
                    <ol>
                        <li>**Frontend:** Collects form data, sends a `POST` request to `/media`.</li>
                        <li>**Backend:** Receives the request, validates the data, calls `database.create_media()`.</li>
                        <li>**Database:** Writes the new media item to `media_data.json`.</li>
                        <li>**Backend:** Returns a `201 Created` status with the new media ID.</li>
                        <li>**Frontend:** Updates the list view with the new item.</li>
                    </ol>
                </div>
            </div>

            <div class="card animated" data-delay="1.1">
                <h3 class="card-header"><i class="fas fa-file-code"></i> Data Format (Metadata Store)</h3>
                <p>The data is stored in a persistent **JSON file** (`media_data.json`) for simplicity and easy portability. The structure includes two main dictionaries: `media` (indexed by ID) and `favorites` (a list of media IDs).</p>
                <pre class="code-pre" style="background-color: #1f1f1f; color: var(--color-code-text); border: 1px solid #444; margin-top: 15px;">
<span class="keyword">{</span>
    <span class="string">"media"</span><span class="keyword">:</span> <span class="keyword">{</span>
        <span class="string">"1"</span><span class="keyword">:</span> <span class="keyword">{</span>
            <span class="string">'name'</span><span class="keyword">:</span> <span class="string">'The Martian'</span><span class="keyword">,</span>
            <span class="string">'publication_date'</span><span class="keyword">:</span> <span class="string">'2011-09-27'</span><span class="keyword">,</span>
            <span class="string">'author'</span><span class="keyword">:</span> <span class="string">'Andy Weir'</span><span class="keyword">,</span>
            <span class="string">'category'</span><span class="keyword">:</span> <span class="string">'Book'</span><span class="keyword">,</span>
        <span class="keyword">}</span><span class="comment">, // ... other media items</span>
    <span class="keyword">}</span><span class="keyword">,</span>
    <span class="string">"favorites"</span><span class="keyword">:</span> <span class="keyword">[1, 5]</span> <span class="comment">// List of media IDs marked as favorites</span>
<span class="keyword">}</span>
                </pre>
            </div>
        </section>

        <section id="ui">
            <h2 class="section-title animated" data-delay="1.2"><i class="fas fa-palette"></i> User Interface & Error Handling</h2>
            
            <div class="card animated" data-delay="1.3">
                <h3 class="card-header"><i class="fas fa-desktop"></i> GUI Sketch and Layout</h3>
                <p>The Tkinter GUI is designed with a modern, two-panel layout to maximize screen utility and user flow.</p>
                <div class="architecture-grid" style="margin-top: 15px;">
                    <div class="architecture-item">
                        <h4>Left Panel: List & Controls</h4>
                        <ul>
                            <li>Primary Media List (Treeview) showing **Year, Category, Name**.</li>
                            <li>Filtering Radio Buttons (`All`, `Book`, `Film`, `Magazine`).</li>
                            <li>Global controls: `[Refresh]`, `[Show Favorites]`, `[+ Create New]`.</li>
                        </ul>
                    </div>
                    <div class="architecture-item">
                        <h4>Right Panel: Statistics & Details</h4>
                        <ul>
                            <li>**Library Statistics** (Always Visible, fetched via `/stats`).</li>
                            <li>**Media Details** (Updates on selection).</li>
                            <li>Action Buttons: `[‚úèÔ∏è Edit]`, `[‚≠ê Favorite]`, `[üóëÔ∏è Delete]`.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card animated" data-delay="1.4">
                <h3 class="card-header"><i class="fas fa-exclamation-triangle"></i> Anticipated Exceptions & Handling</h3>
                <p>Robust error handling is implemented across the Frontend and Backend to ensure stability and provide informative feedback.</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Exception Type</th>
                            <th>Location</th>
                            <th>Handling Mechanism</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>**Connection Error**</td>
                            <td>Frontend (`requests.exceptions.ConnectionError`)</td>
                            <td>Display a **Tkinter `messagebox.showerror`** warning the user to start the backend server.</td>
                        </tr>
                        <tr>
                            <td>**Database File Corruption**</td>
                            <td>Database (`json.JSONDecodeError`)</td>
                            <td>The `load_data` function **safely reverts to the `INITIAL_MEDIA_DATA`** structure to prevent application crash.</td>
                        </tr>
                        <tr>
                            <td>**Missing Input Fields**</td>
                            <td>Backend (`400 Bad Request`)</td>
                            <td>Backend returns a `400` status. Frontend captures the error message and displays a specific **Tkinter `messagebox`**.</td>
                        </tr>
                        <tr>
                            <td>**Invalid Date Format**</td>
                            <td>Frontend (Validation)</td>
                            <td>Validation check on input fields prevents invalid requests (e.g., date not in `YYYY-MM-DD` format) from ever being sent.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="code">
            <h2 class="section-title animated" data-delay="1.5"><i class="fas fa-file-code"></i> Code Structure & Download</h2>
            <p style="text-align: center; margin-bottom: 30px;">Download the complete source code or click on the file header to view the entire content.</p>
            
            <div class="code-container animated" data-delay="1.6">
                
                <div class="code-block-wrapper">
                    <div class="code-header" onclick="toggleCode('frontend-code')">
                        <span><i class="fas fa-desktop"></i> frontend.py (Tkinter GUI Client)</span>
                        <div>
                            <a href="frontend.py" download="frontend.py" class="download-btn"><i class="fas fa-download"></i> Download</a>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                    </div>
                    <div class="code-content" id="frontend-code">
                        <pre class="code-pre">
<span class="comment"># frontend.py - Updated with Statistics Panel and Publication Year</span>
<span class="keyword">import</span> tkinter <span class="keyword">as</span> tk
<span class="keyword">from</span> tkinter <span class="keyword">import</span> ttk, messagebox, filedialog
<span class="keyword">import</span> requests
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime
<span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageTk
<span class="keyword">import</span> io

<span class="comment"># Base URL for the Flask backend (MUST match the running server address)</span>
BASE_URL <span class="keyword">=</span> <span class="string">"http://127.0.0.1:5000"</span>

<span class="comment"># --- Modern Color Palette ---</span>
COLOR_PRIMARY <span class="keyword">=</span> <span class="string">"#4A90E2"</span>
COLOR_SECONDARY <span class="keyword">=</span> <span class="string">"#50C479"</span>
COLOR_BG_LIGHT <span class="keyword">=</span> <span class="string">"#F4F7F6"</span>
COLOR_TEXT_DARK <span class="keyword">=</span> <span class="string">"#333333"</span>
COLOR_HEADER_BG <span class="keyword">=</span> <span class="string">"#2C3E50"</span>
COLOR_HEADER_TEXT <span class="keyword">=</span> <span class="string">"white"</span>
COLOR_FAVORITES <span class="keyword">=</span> <span class="string">"#FFD700"</span>
COLOR_EDIT <span class="keyword">=</span> <span class="string">"#FF8C00"</span>
COLOR_STATS_BG <span class="keyword">=</span> <span class="string">"#E0E6E9"</span>

<span class="class">class</span> <span class="class">LibraryDeskApp</span><span class="keyword">:</span>
    <span class="function">def</span> <span class="function">__init__</span><span class="keyword">(</span>self, master<span class="keyword">):</span>
        self<span class="keyword">.</span>master <span class="keyword">=</span> master
        master<span class="keyword">.</span>title<span class="keyword">(</span><span class="string">"üìö Library Desk"</span><span class="keyword">)</span> 
        master<span class="keyword">.</span>geometry<span class="keyword">(</span><span class="string">"1100x750"</span><span class="keyword">)</span> 
        master<span class="keyword">.</span>config<span class="keyword">(</span>bg<span class="keyword">=</span>COLOR_BG_LIGHT<span class="keyword">)</span>
        
        <span class="comment"># --- Theme and Style Configuration ---</span>
        style <span class="keyword">=</span> ttk<span class="keyword">.</span>Style<span class="keyword">()</span>
        style<span class="keyword">.</span>theme_use<span class="keyword">(</span><span class="string">'clam'</span><span class="keyword">)</span><span class="comment">...</span>
<span class="comment"># The rest of the frontend.py code content goes here. (Full content from uploaded:frontend.py)</span>
<span class="comment">... (The code snippet content is truncated for website display but the full file is included) ...</span>
<span class="comment"># The rest of the frontend.py code content goes here. (Full content from uploaded:frontend.py)</span>
<span class="comment">...a media item from the favorites list."""</span>
        <span class="keyword">try</span><span class="keyword">:</span>
            <span class="keyword">if</span> database<span class="keyword">.</span>remove_favorite<span class="keyword">(</span>media_id<span class="keyword">):</span>
                <span class="keyword">return</span> jsonify<span class="keyword">({</span><span class="string">'message'</span><span class="keyword">:</span> f<span class="string">'Media item {media_id} removed from favorites'</span><span class="keyword">})</span>, <span class="number">200</span>
            <span class="keyword">else</span><span class="keyword">:</span>
                <span class="keyword">return</span> jsonify<span class="keyword">({</span><span class="string">'error'</span><span class="keyword">:</span> <span class="string">'Media item was not in favorites'</span><span class="keyword">})</span>, <span class="number">404</span>
        <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e<span class="keyword">:</span>
            app<span class="keyword">.</span>logger<span class="keyword">.</span>error<span class="keyword">(</span>f<span class="string">"Error removing favorite: {e}"</span><span class="keyword">)</span>
            <span class="keyword">return</span> jsonify<span class="keyword">({</span><span class="string">"error"</span><span class="keyword">:</span> <span class="string">"Internal server error."</span><span class="keyword">})</span>, <span class="number">500</span>

<span class="comment"># --- NEW STATISTICS ENDPOINT ---</span>
@app<span class="keyword">.</span>route<span class="keyword">(</span><span class="string">'/stats'</span>, methods<span class="keyword">=</span><span class="keyword">[</span><span class="string">'GET'</span><span class="keyword">])</span>
<span class="function">def</span> <span class="function">get_statistics</span><span class="keyword">():</span>
    <span class="string">"""Returns overall media statistics."""</span>
    <span class="keyword">try</span><span class="keyword">:</span>
        stats <span class="keyword">=</span> database<span class="keyword">.</span>get_media_statistics<span class="keyword">()</span>
        <span class="keyword">return</span> jsonify<span class="keyword">(</span>stats<span class="keyword">)</span>
    <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e<span class="keyword">:</span>
        app<span class="keyword">.</span>logger<span class="keyword">.</span>error<span class="keyword">(</span>f<span class="string">"Error fetching statistics: {e}"</span><span class="keyword">)</span>
        <span class="keyword">return</span> jsonify<span class="keyword">({</span><span class="string">"error"</span><span class="keyword">:</span> <span class="string">"Internal server error occurred while fetching statistics."</span><span class="keyword">})</span>, <span class="number">500</span>


<span class="comment"># Run the Flask app</span>
<span class="keyword">if</span> __name__ <span class="keyword">==</span> <span class="string">'__main__'</span><span class="keyword">:</span>
    <span class="keyword">try</span><span class="keyword">:</span>
        <span class="function">print</span><span class="keyword">(</span><span class="string">"--- Starting Flask Backend Server ---"</span><span class="keyword">)</span>
        <span class="keyword">if</span> <span class="string">'database'</span> <span class="keyword">not</span> <span class="keyword">in</span> sys<span class="keyword">.</span>modules <span class="keyword">or</span> database<span class="keyword">.</span>db_store <span class="keyword">is</span> <span class="keyword">None</span><span class="keyword">:</span>
             <span class="function">print</span><span class="keyword">(</span><span class="string">"ERROR: database.py module could not be imported or initialized."</span><span class="keyword">)</span>
             database<span class="keyword">.</span>load_data<span class="keyword">()</span>
        
        <span class="comment"># CRITICAL FIX: Ensure reloader is OFF to prevent global variable corruption</span>
        app<span class="keyword">.</span>run<span class="keyword">(</span>debug<span class="keyword">=</span><span class="keyword">True</span>, port<span class="keyword">=</span><span class="number">5000</span>, use_reloader<span class="keyword">=</span><span class="keyword">False</span><span class="keyword">)</span> 
        
    <span class="keyword">except</span> <span class="funct...<ctrl46>}ion">Exception</span> <span class="keyword">as</span> e<span class="keyword">:</span>
        <span class="function">print</span><span class="keyword">(</span><span class="string">f"Failed to start server: {e}"</span><span class="keyword">)</span>
                        </pre>
                    </div>
                </div>

                <div class="code-block-wrapper">
                    <div class="code-header" onclick="toggleCode('backend-code')">
                        <span><i class="fas fa-server"></i> backend.py (Flask API Server)</span>
                        <div>
                            <a href="backend.py" download="backend.py" class="download-btn"><i class="fas fa-download"></i> Download</a>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                    </div>
                    <div class="code-content" id="backend-code">
                        <pre class="code-pre">